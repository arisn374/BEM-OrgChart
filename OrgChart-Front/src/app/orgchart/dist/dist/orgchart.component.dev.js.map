{"version":3,"sources":["orgchart.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { OrgService } from 'src/app/services/orgservice.service';\n\ndeclare var $: any;\ndeclare var JSONLoop: any;\n@Component({\n  selector: 'app-orgchart',\n  templateUrl: './orgchart.component.html',\n  styleUrls: ['./orgchart.component.css']\n})\nexport class OrgchartComponent implements OnInit {\n\n  dataset: OrgDepartment[] = [];\n  constructor(private orgService: OrgService) {\n\n  }\n  ngOnInit(): void {\n    let nodeTemplate = function (data: any) {\n      let html = '<div class=\"card border-primary  \">';\n      html += '<div class=\"card-header\"><b>' + data.nodeName + '</b>';\n      if (data.count != 0) {\n        html += '<h5><span deptcode=\"' + data.deptCode + '\" class=\" empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary\" style=\"cursor:zoom-in;border-radius: 50px 50px;\">';\n        html += data.count + '</span></h5>';\n      }\n      html += '</div></div>';\n      return `\n      <div class=\"card border-primary blog_post\">\n      <div class=\"card-header container_card\"><b>${data.nodeName}</b><h4>\n      <span deptcode=\"${data.deptCode}\" class=\"empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary\">\n      <label class=\"info\">i</label>\n      </span></h4></div>\n      </div>\n      `;\n      return html;\n    };\n   // ${data.Total}\n    let datasource: any = {};\n\n    this.orgService.getOrgDepartment().subscribe((res) => {\n      // console.log(res);\n      res = JSON.parse(JSON.stringify(res).replace(/\\s(?=\\w+\":)/g, \"\"));\n      this.dataset = <OrgDepartment[]>res;\n\n      this.dataset.forEach(function (item: any, index) {\n        if (!item.nodeParent) {\n          delete item.nodeParent;\n          Object.assign(datasource, item);\n        } else {\n          var jsonloop = new JSONLoop(datasource, 'nodeCode', 'children');\n          jsonloop.findNodeById(datasource, item.nodeParent, function (err: any, node: any) {\n            if (err) {\n              console.error(err);\n            } else {\n              delete item.nodeParent;\n              if (node.children) {\n                node.children.push(item);\n              } else {\n                node.children = [item];\n              }\n            }\n          });\n        }\n      });\n\n      let oc = $('#chart-container').orgchart({\n        'data': datasource,\n        'pan': true,\n        'zoom': true,\n        'nodeTemplate': nodeTemplate,\n        'verticalLevel': 5,\n        'visibleLevel': 5,\n        'createNode': function ($node: any, data: any) {\n          $node.find('span.empcount').on('click', function () {\n            let htmlTable = `\n            <table id=\"empTable\" class=\"table table-hover\">\n           \n            </table>\n            `;\n\n            $('#empList').html(htmlTable);\n\n            $.fn.dataTable.ext.errMode = 'none';\n \n            var empTable = $('#empTable').DataTable({\n              ordering: false,\n              autoWidth: false,\n              responsive: true,\n              odering : true,\n              lengthMenu: [[2, 5, 10, -1], [2, 5, 10, \"All\"]],\n              ajax: {\n                // url: 'https://app.bemplc.co.th/OrgDevapi/employeeOrg',\n                //  url:'https://192.168.2.211/orgchart_api/employeeOrg',\n              url:'http://172.15.1.93/OrgDevapi/employeeOrg',\n              dataType: 'json',\n                type: 'GET',\n                dataSrc: function (json: any) {\n                  json = JSON.parse(JSON.stringify(json).replace(/\\s(?=\\w+\":)/g, \"\"));\n                  //data = org , x.dept = employee\n                  let findemp = json.filter((x: any) => x.deptCode == data.deptCode);\n                  findemp.sort(function (a: any, b: any) {\n                      if (a.positionOrder < b.positionOrder) {\n                        return ((a.positionOrder < b.positionOrder) ? -1 : ((a.positionOrder > b.positionOrder) ? 1 : 0));\n                        }\n                    return 0;\n                  });\n                  return findemp;\n                }\n              },\n              columns: [\n                {\n                  data: \"\",\n                  title: \"\",\n                  render: function (data: any, type: any, row: any, meta: any) {\n                     \n                    // ใส่ url ให้มันผิดเพื่อปิดไม่ให้ show รูป\n                    return `\n                              <div class=\"card border-light\">\n                              <div class=\"row g-0\">\n                                <div class=\"col-sm-2\">\n                                  <img src=\"/OrgDev/assets/images/icons8-user-100.png\" class=\"backup_picture img-fluid rounded-start\"  >\n                                  </div>\n                                <div class=\"col-sm-10\">\n                                  <div class=\"card-body\">\n                                    <h5 class=\"card-title\">${row.thName}${((!!row.eM_NICKNAME) ? ' (' + row.eM_NICKNAME + ')' : '')}<br/>${row.engName}</h5> \n                                    <p class=\"card-text\"><strong class=\"text-muted\"> เบอร์ติดต่อ : ${(replacenull(row.telPrimary) != \"\") ? + row.telPrimary  : ''}  ${(replacenull(row.telSecondary) != \"\") ? ( ',' + row.telSecondary ) : ''}</strong>\n                                    <hr>\n                                    <p class=\"card-text\"><strong class=\"text-muted\">${(replacenull(row.positionName) != \"\") ? ' (' + row.positionName + ')' : ''}</strong> \n                                    \n                                    </p>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                            `; \n                  }\n                }\n              ]\n            });\n\n            empTable.columns('PositionOrder').order('asc').draw();\n\n\n            $('#deptNameTitle').html(data.nodeName + '<br/>(' + data.nodeNameEn + ')');\n            $('#empModal').modal('show');\n\n          });\n        }\n      });\n\n      oc.$chart.find('.node').on('click', function (this: any) {\n        $('#selected-node').val($(this).find('.card-header b').text());\n      });\n\n      $('#btn-report-path').on('click', function (this: any) {\n        var $selected = $('#chart-container').find('.node.focused');\n        if ($selected.length) {\n          $selected.parents('.nodes').children(':has(.focused)').find('.node:first').each(function (index: any, superior: any) {\n            if (!$(superior).find('.horizontalEdge:first').closest('table').parent().siblings().is('.hidden')) {\n              $(superior).find('.horizontalEdge:first').trigger('click');\n            }\n          });\n          $(this).prop('disabled', true);\n        } else {\n          alert('please select the node firstly');\n        }\n      });\n\n      $('#btn-reset').on('click', function () {\n        oc.init({ 'data': datasource });\n        oc.$chart.find('.node').on('click', function (this: any) {\n          $('#selected-node').val($(this).find('.card-header b').text());\n        });\n        $('#btn-report-path').prop('disabled', false);\n        $('#selected-node').val('');\n      });\n\n      $('#btn-export-png').on('click', function () {\n        oc.export('BEM-OrgChart-' + new Date().toISOString().split('T')[0], 'png');\n      });\n      $('#btn-export-pdf').on('click', function () {\n        oc.export('BEM-OrgChart-' + new Date().toISOString().split('T')[0], 'pdf');\n      });\n    });\n\n    function replacenull(value: any) {\n      return (value === null) ? \"\" : value;\n    }\n  }\n}\n\n\ninterface OrgDepartment {\n  nodeCode: string;\n  nodeParent: string;\n  nodeName: string;\n  nodeNameEn: string;\n}\n\n\n// imgSource : {row.eM_CODE.toString().substring(row.eM_CODE.toString().length - 4)}.jpg\" class=\"backup_picture img-fluid rounded-start\" onerror=this.src=\"/assets/images/icons8-user-100.png\">"],"file":"orgchart.component.dev.js"}