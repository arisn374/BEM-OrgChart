{"version":3,"sources":["orgchart.component.ts"],"names":["core_1","require","OrgchartComponent","orgService","this","dataset","prototype","ngOnInit","nodeTemplate","data","nodeName","count","deptCode","_this","datasource","replacenull","value","getOrgDepartment","subscribe","res","JSON","parse","stringify","replace","forEach","item","index","nodeParent","JSONLoop","findNodeById","err","node","console","error","children","push","Object","assign","oc","$","orgchart","pan","zoom","verticalLevel","visibleLevel","createNode","$node","find","on","html","fn","dataTable","ext","errMode","DataTable","ordering","autoWidth","responsive","odering","lengthMenu","ajax","url","dataType","type","dataSrc","json","findemp","filter","x","sort","a","b","positionOrder","columns","title","render","row","meta","eM_CODE","toString","substring","length","thName","eM_NICKNAME","engName","telPrimary","telSecondary","positionName","order","draw","nodeNameEn","modal","$chart","val","text","$selected","parents","each","superior","closest","parent","siblings","is","trigger","prop","alert","init","Date","toISOString","split","__decorate","Component","selector","templateUrl","styleUrls","exports"],"mappings":"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","file":"orgchart.component.min.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { OrgService } from 'src/app/services/orgservice.service';\n\ndeclare var $: any;\ndeclare var JSONLoop: any;\n@Component({\n  selector: 'app-orgchart',\n  templateUrl: './orgchart.component.html',\n  styleUrls: ['./orgchart.component.css']\n})\nexport class OrgchartComponent implements OnInit {\n\n  dataset: OrgDepartment[] = [];\n  constructor(private orgService: OrgService) {\n\n  }\n  ngOnInit(): void {\n    let nodeTemplate = function (data: any) {\n      let html = '<div class=\"card border-primary  \">';\n      html += '<div class=\"card-header\"><b>' + data.nodeName + '</b>';\n      if (data.count != 0) {\n        html += '<h5><span deptcode=\"' + data.deptCode + '\" class=\"empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary\" style=\"cursor:zoom-in;border-radius: 50px 50px;min-width:max-content;\">';\n        html += data.count + '</span></h5>';\n      }\n      html += '</div></div>';\n      return `\n      <div class=\"card border-primary blog_post\">\n      <div class=\"card-header container_card\"><b>${data.nodeName}</b><h4><span deptcode=\"${data.deptCode}\" \n      class=\"empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary\" style=\"cursor:zoom-in;border-radius: 50px 50px;min-width:max-content;\">\n      <strong>i</strong>\n      </span></h4></div>\n      </div>\n      `;\n      return html;\n    };\n   // ${data.Total}\n    let datasource: any = {};\n\n    this.orgService.getOrgDepartment().subscribe((res) => {\n      // console.log(res);\n      res = JSON.parse(JSON.stringify(res).replace(/\\s(?=\\w+\":)/g, \"\"));\n      this.dataset = <OrgDepartment[]>res;\n\n      this.dataset.forEach(function (item: any, index) {\n        if (!item.nodeParent) {\n          delete item.nodeParent;\n          Object.assign(datasource, item);\n        } else {\n          var jsonloop = new JSONLoop(datasource, 'nodeCode', 'children');\n          jsonloop.findNodeById(datasource, item.nodeParent, function (err: any, node: any) {\n            if (err) {\n              console.error(err);\n            } else {\n              delete item.nodeParent;\n              if (node.children) {\n                node.children.push(item);\n              } else {\n                node.children = [item];\n              }\n            }\n          });\n        }\n      });\n\n      let oc = $('#chart-container').orgchart({\n        'data': datasource,\n        'pan': true,\n        'zoom': true,\n        'nodeTemplate': nodeTemplate,\n        'verticalLevel': 5,\n        'visibleLevel': 5,\n        'createNode': function ($node: any, data: any) {\n          $node.find('span.empcount').on('click', function () {\n            let htmlTable = `\n            <table id=\"empTable\" class=\"table table-hover\">\n           \n            </table>\n            `;\n\n            $('#empList').html(htmlTable);\n\n            $.fn.dataTable.ext.errMode = 'none';\n \n            var empTable = $('#empTable').DataTable({\n              ordering: false,\n              autoWidth: false,\n              responsive: true,\n              odering : true,\n              lengthMenu: [[2, 5, 10, -1], [2, 5, 10, \"All\"]],\n              ajax: {\n                 url:'https://192.168.2.211/orgchart_api/employeeOrg',\n                // url:'http://192.168.2.129/orgchartapi/employeeOrg',\n                    dataType: 'json',\n                type: 'GET',\n                dataSrc: function (json: any) {\n                  json = JSON.parse(JSON.stringify(json).replace(/\\s(?=\\w+\":)/g, \"\"));\n                  //data = org , x.dept = employee\n                  let findemp = json.filter((x: any) => x.deptCode == data.deptCode);\n                  findemp.sort(function (a: any, b: any) {\n                      if (a.positionOrder < b.positionOrder) {\n                        return ((a.positionOrder < b.positionOrder) ? -1 : ((a.positionOrder > b.positionOrder) ? 1 : 0));\n                        }\n                    return 0;\n                  });\n                  return findemp;\n                }\n              },\n              columns: [\n                {\n                  data: \"\",\n                  title: \"\",\n                  render: function (data: any, type: any, row: any, meta: any) {\n                     \n                    // ใส่ url ให้มันผิดเพื่อปิดไม่ให้ show รูป\n                    return `\n                              <div class=\"card border-light\">\n                              <div class=\"row g-0\">\n                                <div class=\"col-sm-2\">\n                                  <img src=\"https://apphrbem.com/Profile/imges/BMC_disable${row.eM_CODE.toString().substring(row.eM_CODE.toString().length - 4)}.jpg\" class=\"backup_picture img-fluid rounded-start\" onerror=this.src=\"/assets/images/icons8-user-100.png\">\n                                </div>\n                                <div class=\"col-sm-10\">\n                                  <div class=\"card-body\">\n                                    <h5 class=\"card-title\">${row.thName}${((!!row.eM_NICKNAME) ? ' (' + row.eM_NICKNAME + ')' : '')}<br/>${row.engName}</h5> \n                                    <p class=\"card-text\"><strong class=\"text-muted\"> เบอร์ติดต่อ : ${(replacenull(row.telPrimary) != \"\") ? + row.telPrimary  : ''}  ${(replacenull(row.telSecondary) != \"\") ? ( ',' + row.telSecondary ) : ''}</strong>\n                                    <hr>\n                                    <p class=\"card-text\"><strong class=\"text-muted\">${(replacenull(row.positionName) != \"\") ? ' (' + row.positionName + ')' : ''}</strong> \n                                    \n                                    </p>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                            `; \n                  }\n                }\n              ]\n            });\n\n            empTable.columns('PositionOrder').order('asc').draw();\n\n\n            $('#deptNameTitle').html(data.nodeName + '<br/>(' + data.nodeNameEn + ')');\n            $('#empModal').modal('show');\n\n          });\n        }\n      });\n\n      oc.$chart.find('.node').on('click', function (this: any) {\n        $('#selected-node').val($(this).find('.card-header b').text());\n      });\n\n      $('#btn-report-path').on('click', function (this: any) {\n        var $selected = $('#chart-container').find('.node.focused');\n        if ($selected.length) {\n          $selected.parents('.nodes').children(':has(.focused)').find('.node:first').each(function (index: any, superior: any) {\n            if (!$(superior).find('.horizontalEdge:first').closest('table').parent().siblings().is('.hidden')) {\n              $(superior).find('.horizontalEdge:first').trigger('click');\n            }\n          });\n          $(this).prop('disabled', true);\n        } else {\n          alert('please select the node firstly');\n        }\n      });\n\n      $('#btn-reset').on('click', function () {\n        oc.init({ 'data': datasource });\n        oc.$chart.find('.node').on('click', function (this: any) {\n          $('#selected-node').val($(this).find('.card-header b').text());\n        });\n        $('#btn-report-path').prop('disabled', false);\n        $('#selected-node').val('');\n      });\n\n      $('#btn-export-png').on('click', function () {\n        oc.export('BEM-OrgChart-' + new Date().toISOString().split('T')[0], 'png');\n      });\n      $('#btn-export-pdf').on('click', function () {\n        oc.export('BEM-OrgChart-' + new Date().toISOString().split('T')[0], 'pdf');\n      });\n    });\n\n    function replacenull(value: any) {\n      return (value === null) ? \"\" : value;\n    }\n  }\n}\n\n\ninterface OrgDepartment {\n  nodeCode: string;\n  nodeParent: string;\n  nodeName: string;\n  nodeNameEn: string;\n}"]}