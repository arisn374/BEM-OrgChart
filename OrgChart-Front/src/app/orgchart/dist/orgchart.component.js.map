{"version":3,"sources":["orgchart.component.ts"],"names":[],"mappings":"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","file":"orgchart.component.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { OrgService } from 'src/app/services/orgservice.service';\n\ndeclare var $: any;\ndeclare var JSONLoop: any;\n@Component({\n  selector: 'app-orgchart',\n  templateUrl: './orgchart.component.html',\n  styleUrls: ['./orgchart.component.css']\n})\nexport class OrgchartComponent implements OnInit {\n\n  dataset: OrgDepartment[] = [];\n  constructor(private orgService: OrgService) {\n\n  }\n  ngOnInit(): void {\n    let nodeTemplate = function (data: any) {\n      let html = '<div class=\"card border-primary  \">';\n      html += '<div class=\"card-header\"><b>' + data.nodeName + '</b>';\n      if (data.count != 0) {\n        html += '<h5><span deptcode=\"' + data.deptCode + '\" class=\"empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary\" style=\"cursor:zoom-in;border-radius: 50px 50px;min-width:max-content;\">';\n        html += data.count + '</span></h5>';\n      }\n      html += '</div></div>';\n      return `\n      <div class=\"card border-primary blog_post\">\n      <div class=\"card-header container_card\"><b>${data.nodeName}</b><h4><span deptcode=\"${data.deptCode}\" \n      class=\"empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary\" style=\"cursor:zoom-in;border-radius: 50px 50px;min-width:max-content;\">\n      <strong>i</strong>\n      </span></h4></div>\n      </div>\n      `;\n      return html;\n    };\n   // ${data.Total}\n    let datasource: any = {};\n\n    this.orgService.getOrgDepartment().subscribe((res) => {\n      // console.log(res);\n      res = JSON.parse(JSON.stringify(res).replace(/\\s(?=\\w+\":)/g, \"\"));\n      this.dataset = <OrgDepartment[]>res;\n\n      this.dataset.forEach(function (item: any, index) {\n        if (!item.nodeParent) {\n          delete item.nodeParent;\n          Object.assign(datasource, item);\n        } else {\n          var jsonloop = new JSONLoop(datasource, 'nodeCode', 'children');\n          jsonloop.findNodeById(datasource, item.nodeParent, function (err: any, node: any) {\n            if (err) {\n              console.error(err);\n            } else {\n              delete item.nodeParent;\n              if (node.children) {\n                node.children.push(item);\n              } else {\n                node.children = [item];\n              }\n            }\n          });\n        }\n      });\n\n      let oc = $('#chart-container').orgchart({\n        'data': datasource,\n        'pan': true,\n        'zoom': true,\n        'nodeTemplate': nodeTemplate,\n        'verticalLevel': 5,\n        'visibleLevel': 5,\n        'createNode': function ($node: any, data: any) {\n          $node.find('span.empcount').on('click', function () {\n            let htmlTable = `\n            <table id=\"empTable\" class=\"table table-hover\">\n           \n            </table>\n            `;\n\n            $('#empList').html(htmlTable);\n\n            $.fn.dataTable.ext.errMode = 'none';\n \n            var empTable = $('#empTable').DataTable({\n              ordering: false,\n              autoWidth: false,\n              responsive: true,\n              odering : true,\n              lengthMenu: [[2, 5, 10, -1], [2, 5, 10, \"All\"]],\n              ajax: {\n                 url:'https://192.168.2.211/orgchart_api/employeeOrg',\n                // url:'http://192.168.2.129/orgchartapi/employeeOrg',\n                    dataType: 'json',\n                type: 'GET',\n                dataSrc: function (json: any) {\n                  json = JSON.parse(JSON.stringify(json).replace(/\\s(?=\\w+\":)/g, \"\"));\n                  //data = org , x.dept = employee\n                  let findemp = json.filter((x: any) => x.deptCode == data.deptCode);\n                  findemp.sort(function (a: any, b: any) {\n                      if (a.positionOrder < b.positionOrder) {\n                        return ((a.positionOrder < b.positionOrder) ? -1 : ((a.positionOrder > b.positionOrder) ? 1 : 0));\n                        }\n                    return 0;\n                  });\n                  return findemp;\n                }\n              },\n              columns: [\n                {\n                  data: \"\",\n                  title: \"\",\n                  render: function (data: any, type: any, row: any, meta: any) {\n                     \n                    // ใส่ url ให้มันผิดเพื่อปิดไม่ให้ show รูป\n                    return `\n                              <div class=\"card border-light\">\n                              <div class=\"row g-0\">\n                                <div class=\"col-sm-2\">\n                                  <img src=\"https://apphrbem.com/Profile/imges/BMC_disable${row.eM_CODE.toString().substring(row.eM_CODE.toString().length - 4)}.jpg\" class=\"backup_picture img-fluid rounded-start\" onerror=this.src=\"/assets/images/icons8-user-100.png\">\n                                </div>\n                                <div class=\"col-sm-10\">\n                                  <div class=\"card-body\">\n                                    <h5 class=\"card-title\">${row.thName}${((!!row.eM_NICKNAME) ? ' (' + row.eM_NICKNAME + ')' : '')}<br/>${row.engName}</h5> \n                                    <p class=\"card-text\"><strong class=\"text-muted\"> เบอร์ติดต่อ : ${(replacenull(row.telPrimary) != \"\") ? + row.telPrimary  : ''}  ${(replacenull(row.telSecondary) != \"\") ? ( ',' + row.telSecondary ) : ''}</strong>\n                                    <hr>\n                                    <p class=\"card-text\"><strong class=\"text-muted\">${(replacenull(row.positionName) != \"\") ? ' (' + row.positionName + ')' : ''}</strong> \n                                    \n                                    </p>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                            `; \n                  }\n                }\n              ]\n            });\n\n            empTable.columns('PositionOrder').order('asc').draw();\n\n\n            $('#deptNameTitle').html(data.nodeName + '<br/>(' + data.nodeNameEn + ')');\n            $('#empModal').modal('show');\n\n          });\n        }\n      });\n\n      oc.$chart.find('.node').on('click', function (this: any) {\n        $('#selected-node').val($(this).find('.card-header b').text());\n      });\n\n      $('#btn-report-path').on('click', function (this: any) {\n        var $selected = $('#chart-container').find('.node.focused');\n        if ($selected.length) {\n          $selected.parents('.nodes').children(':has(.focused)').find('.node:first').each(function (index: any, superior: any) {\n            if (!$(superior).find('.horizontalEdge:first').closest('table').parent().siblings().is('.hidden')) {\n              $(superior).find('.horizontalEdge:first').trigger('click');\n            }\n          });\n          $(this).prop('disabled', true);\n        } else {\n          alert('please select the node firstly');\n        }\n      });\n\n      $('#btn-reset').on('click', function () {\n        oc.init({ 'data': datasource });\n        oc.$chart.find('.node').on('click', function (this: any) {\n          $('#selected-node').val($(this).find('.card-header b').text());\n        });\n        $('#btn-report-path').prop('disabled', false);\n        $('#selected-node').val('');\n      });\n\n      $('#btn-export-png').on('click', function () {\n        oc.export('BEM-OrgChart-' + new Date().toISOString().split('T')[0], 'png');\n      });\n      $('#btn-export-pdf').on('click', function () {\n        oc.export('BEM-OrgChart-' + new Date().toISOString().split('T')[0], 'pdf');\n      });\n    });\n\n    function replacenull(value: any) {\n      return (value === null) ? \"\" : value;\n    }\n  }\n}\n\n\ninterface OrgDepartment {\n  nodeCode: string;\n  nodeParent: string;\n  nodeName: string;\n  nodeNameEn: string;\n}"]}