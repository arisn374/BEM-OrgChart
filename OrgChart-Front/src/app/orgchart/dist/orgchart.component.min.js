"use strict";var __decorate=this&&this.__decorate||function(e,t,n,r){var o,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var d=e.length-1;0<=d;d--)(o=e[d])&&(i=(a<3?o(i):3<a?o(t,n,i):o(t,n))||i);return 3<a&&i&&Object.defineProperty(t,n,i),i};exports.__esModule=!0;var core_1=require("@angular/core"),OrgchartComponent=function(){function e(e){this.orgService=e,this.dataset=[]}return e.prototype.ngOnInit=function(){function n(e){return'<div class="card-header"><b>'+e.nodeName+"</b>",0!=e.count&&('<h5><span deptcode="'+e.deptCode+'" class="empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary" style="cursor:zoom-in;border-radius: 50px 50px;min-width:max-content;">',e.count+"</span></h5>"),"</div></div>",'\n      <div class="card border-primary blog_post">\n      <div class="card-header container_card"><b>'+e.nodeName+'</b><h4><span deptcode="'+e.deptCode+'" \n      class="empcount position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary" style="cursor:zoom-in;border-radius: 50px 50px;min-width:max-content;">\n      <strong>i</strong>\n      </span></h4></div>\n      </div>\n      '}var r=this,o={};function a(e){return null===e?"":e}this.orgService.getOrgDepartment().subscribe(function(e){e=JSON.parse(JSON.stringify(e).replace(/\s(?=\w+":)/g,"")),r.dataset=e,r.dataset.forEach(function(n,e){n.nodeParent?new JSONLoop(o,"nodeCode","children").findNodeById(o,n.nodeParent,function(e,t){e?console.error(e):(delete n.nodeParent,t.children?t.children.push(n):t.children=[n])}):(delete n.nodeParent,Object.assign(o,n))});var t=$("#chart-container").orgchart({data:o,pan:!0,zoom:!0,nodeTemplate:n,verticalLevel:5,visibleLevel:5,createNode:function(e,n){e.find("span.empcount").on("click",function(){$("#empList").html('\n            <table id="empTable" class="table table-hover">\n           \n            </table>\n            '),$.fn.dataTable.ext.errMode="none",$("#empTable").DataTable({ordering:!1,autoWidth:!1,responsive:!0,odering:!0,lengthMenu:[[2,5,10,-1],[2,5,10,"All"]],ajax:{url:"https://192.168.2.211/orgchart_api/employeeOrg",dataType:"json",type:"GET",dataSrc:function(e){var t=(e=JSON.parse(JSON.stringify(e).replace(/\s(?=\w+":)/g,""))).filter(function(e){return e.deptCode==n.deptCode});return t.sort(function(e,t){return e.positionOrder<t.positionOrder?e.positionOrder<t.positionOrder?-1:e.positionOrder>t.positionOrder?1:0:0}),t}},columns:[{data:"",title:"",render:function(e,t,n,r){return'\n                              <div class="card border-light">\n                              <div class="row g-0">\n                                <div class="col-sm-2">\n                                  <img src="https://apphrbem.com/Profile/imges/BMC_disable'+n.eM_CODE.toString().substring(n.eM_CODE.toString().length-4)+'.jpg" class="backup_picture img-fluid rounded-start" onerror=this.src="/assets/images/icons8-user-100.png">\n                                </div>\n                                <div class="col-sm-10">\n                                  <div class="card-body">\n                                    <h5 class="card-title">'+n.thName+(n.eM_NICKNAME?" ("+n.eM_NICKNAME+")":"")+"<br/>"+n.engName+'</h5> \n                                    <p class="card-text"><strong class="text-muted"> เบอร์ติดต่อ : '+(""!=a(n.telPrimary)?+n.telPrimary:"")+"  "+(""!=a(n.telSecondary)?","+n.telSecondary:"")+'</strong>\n                                    <hr>\n                                    <p class="card-text"><strong class="text-muted">'+(""!=a(n.positionName)?" ("+n.positionName+")":"")+"</strong> \n                                    \n                                    </p>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                            "}}]}).columns("PositionOrder").order("asc").draw(),$("#deptNameTitle").html(n.nodeName+"<br/>("+n.nodeNameEn+")"),$("#empModal").modal("show")})}});t.$chart.find(".node").on("click",function(){$("#selected-node").val($(this).find(".card-header b").text())}),$("#btn-report-path").on("click",function(){var e=$("#chart-container").find(".node.focused");e.length?(e.parents(".nodes").children(":has(.focused)").find(".node:first").each(function(e,t){$(t).find(".horizontalEdge:first").closest("table").parent().siblings().is(".hidden")||$(t).find(".horizontalEdge:first").trigger("click")}),$(this).prop("disabled",!0)):alert("please select the node firstly")}),$("#btn-reset").on("click",function(){t.init({data:o}),t.$chart.find(".node").on("click",function(){$("#selected-node").val($(this).find(".card-header b").text())}),$("#btn-report-path").prop("disabled",!1),$("#selected-node").val("")}),$("#btn-export-png").on("click",function(){t.export("BEM-OrgChart-"+(new Date).toISOString().split("T")[0],"png")}),$("#btn-export-pdf").on("click",function(){t.export("BEM-OrgChart-"+(new Date).toISOString().split("T")[0],"pdf")})})},e=__decorate([core_1.Component({selector:"app-orgchart",templateUrl:"./orgchart.component.html",styleUrls:["./orgchart.component.css"]})],e)}();exports.OrgchartComponent=OrgchartComponent;
//# sourceMappingURL=orgchart.component.min.js.map
